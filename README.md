# Task Manager ‚Äî Django + Telegram Bot

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ: –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á —Å –≤–µ–±‚ÄëAPI –Ω–∞ Django –∏ Telegram‚Äë–±–æ—Ç–æ–º –Ω–∞ Aiogram. –í—Å—ë —É–ø–∞–∫–æ–≤–∞–Ω–æ –≤ Docker, –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–¥–∞–∫—à–Ω‚Äë–ø–æ–¥—Ö–æ–¥—ã –∏ —á–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚öôÔ∏è Backend: Django 5 + DRF + SimpleJWT (JWT‚Äë–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
- ü§ñ –ë–æ—Ç: Aiogram 3 + FastAPI (—Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞)
- üóÉÔ∏è –î–∞–Ω–Ω—ã–µ: PostgreSQL (—á–µ—Ä–µ–∑ Docker), Redis –¥–ª—è Celery
- üßµ –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è: Celery (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ –¥–µ–¥–ª–∞–π–Ω–∞–º ‚Äî –∫–æ–Ω—Ç—É—Ä –≥–æ—Ç–æ–≤)
- üì¶ –ó–∞–ø—É—Å–∫ –≤ –æ–¥–∏–Ω —à–∞–≥: Docker Compose –ø–æ–¥–Ω–∏–º–∞–µ—Ç –ë–î, backend –∏ –±–æ—Ç–∞
- üß≠ –ü—Ä–µ–¥–º–µ—Ç–Ω–∞—è –º–æ–¥–µ–ª—å: –ó–∞–¥–∞—á–∏, –ö–∞—Ç–µ–≥–æ—Ä–∏–∏, –ø—Ä–∏–≤—è–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ Telegram
- üß© –ü—Ä–æ–¥—É–º–∞–Ω–Ω—ã–π UX –≤ –±–æ—Ç–µ: –ø–∞–≥–∏–Ω–∞—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä—ã, –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π –∏ –æ—à–∏–±–æ–∫

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ú–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–∑ –¥–≤—É—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

```
backend/   # Django + DRF API
bot/       # FastAPI + Aiogram (Telegram Bot)
```

–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:

- –ë–æ—Ç –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ `/api/v1/bot/auth` (–∑–∞–≥–æ–ª–æ–≤–æ–∫ X‚ÄëInternal‚ÄëToken)
- –¢–æ–∫–µ–Ω—ã access/refresh —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ SQLite –ø–æ chat_id
- DRF –≤—ã–¥–∞—ë—Ç JWT (SimpleJWT); –≤—Å–µ REST‚Äë–≤—ã–∑–æ–≤—ã ‚Äî —á–µ—Ä–µ–∑ Bearer‚Äë—Ç–æ–∫–µ–Ω
- Celery‚Äë–≤–æ—Ä–∫–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –º–æ–∂–µ—Ç —Å–ª–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±–æ—Ç—É —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π HTTP‚Äë–º–∞—Ä—à—Ä—É—Ç

## üìö –ú–æ–¥–µ–ª—å –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏

- Task: id (snowflake), title, status (todo/in_progress/done), due_at, created_at, user, M2M –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- Category: id (snowflake), name
- BotProfile: —Å–≤—è–∑—å Django‚Äë–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å Telegram (telegram_user_id, chat_id)

–ü–∞–≥–∏–Ω–∞—Ü–∏—è: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è PageNumberPagination, —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî 5.

## üó∫Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã API

- POST `/api/v1/bot/auth` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ (–≤—ã–¥–∞—ë—Ç JWT –¥–ª—è TG‚Äë–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- GET `/api/v1/me` ‚Äî –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/api/v1/tasks/` ‚Äî CRUD + —Ñ–∏–ª—å—Ç—Ä—ã: status, category, due_before, due_after (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
- `/api/v1/categories/` ‚Äî CRUD (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)

## ü§ñ UX Telegram‚Äë–±–æ—Ç–∞

–ö–æ–º–∞–Ω–¥—ã:

- `/start` ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ Telegram‚Äë–∞–∫–∫–∞—É–Ω—Ç–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- `/help` ‚Äî –∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞
- `/tasks [todo|in_progress|done]` ‚Äî —Å–ø–∏—Å–æ–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- `/tasks_compact [—Ñ–∏–ª—å—Ç—Ä]` ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º (–≤—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º)
- `/done <id>` ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π
- `/cancel <id>` ‚Äî —Å–Ω—è—Ç—å –¥–µ–¥–ª–∞–π–Ω
- `/add` ‚Äî –ø–æ—à–∞–≥–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (–∑–∞–≥–æ–ª–æ–≤–æ–∫ ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí –¥–µ–¥–ª–∞–π–Ω ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)

–ü–∞–≥–∏–Ω–∞—Ü–∏—è:

- –í–≤–µ—Ä—Ö—É: ¬´–¢–≤–æ–∏ –∑–∞–¥–∞—á–∏ (–≤—Å–µ–≥–æ: N) ‚Äî –°—Ç—Ä. i/j¬ª
- –°—Ç—Ä–µ–ª–∫–∏ ‚óÄÔ∏è ‚ñ∂Ô∏è –ª–∏—Å—Ç–∞—é—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã; ¬´–°—Ç—Ä. N¬ª ‚Äî –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ (–±–µ–∑ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏)

–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å:

- –ê–≤—Ç–æ‚Äë—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –±–æ—Ç–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ (–ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)
- –ê–∫–∫—É—Ä–∞—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∞–µ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤: ¬´message is not modified¬ª, –±—ã—Å—Ç—Ä—ã–µ –∫–ª–∏–∫–∏, —Ä–∞–∑–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç API

## üß™ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker)

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: Docker –∏ Docker Compose.

1) –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env.backend, .env.db, .env.bot):

```
# .env.db
POSTGRES_DB=app
POSTGRES_USER=app
POSTGRES_PASSWORD=app

# .env.backend
DATABASE_URL=postgres://app:app@db:5432/app
SECRET_KEY=dev-secret
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/1
BOT_INTERNAL_URL=http://bot:8080/internal/notify-due
BOT_INTERNAL_TOKEN=supersecret

# .env.bot
TELEGRAM_TOKEN=123456:ABC...   # —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
INTERNAL_TOKEN=supersecret
DJANGO_API_BASE=http://backend:8000
```

2) –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:

```
docker-compose up --build -d
```

3) –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –≤–∞—à–µ–º—É –±–æ—Ç—É.

## üßë‚Äçüíª –ó–∞–º–µ—Ç–∫–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ backend (collectstatic ‚Üí migrate ‚Üí gunicorn)
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã Task/Category ‚Äî snowflake –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–∫–æ—Ä–æ—Ç–∫–∏–µ, —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ, —É–¥–æ–±–Ω–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å)
- –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã DRF ‚Äî 5 (—Å–º. `backend/proj/settings.py`)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (—Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ):

```
backend/app/
	models.py         # Task, Category, BotProfile
	views.py          # TaskViewSet, CategoryViewSet, MeView, BotAuthView
	urls.py           # /api/v1/... endpoints
bot/
	main.py           # FastAPI + Aiogram (polling lifecycle)
	storage.py        # SQLite: chat_id ‚Üí tokens
	service/django_api.py  # HTTP‚Äë–∫–ª–∏–µ–Ω—Ç + with_auto_refresh
	handlers/         # start, help, tasks, pagination, add, actions
	utils/            # —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–∞–≥–∏–Ω–∞—Ü–∏—è‚Äë–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã, –∞–≤—Ç–æ‚Äëauth
```

## üß≠ –° —á–µ–≥–æ –Ω–∞—á–∞—Ç—å —á—Ç–µ–Ω–∏–µ –∫–æ–¥–∞

- –§–∏–ª—å—Ç—Ä—ã –±—ç–∫–µ–Ω–¥–∞: `backend/app/views.py::TaskViewSet.get_queryset`
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –±–æ—Ç–∞: `bot/handlers/pager.py` –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã `bot/utils/pager.py`
- –ü–∞—Ç—Ç–µ—Ä–Ω with_auto_refresh: `bot/service/django_api.py`

## ‚úÖ –ß–µ–∫‚Äë–ª–∏—Å—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

- [x] JWT‚Äë–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–æ—Ç‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç
- [x] –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∑–∞–¥–∞—á–∞–º (—Å—Ç–∞—Ç—É—Å/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–¥–∏–∞–ø–∞–∑–æ–Ω –¥–µ–¥–ª–∞–π–Ω–∞)
- [x] –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º —Å–ø–∏—Å–∫–∞
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å –≤—ã–±–æ—Ä–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ä–∞–∑–±–æ—Ä–æ–º –¥–∞—Ç
- [x] –£—Å—Ç–æ–π—á–∏–≤—ã–π UX –≤ –±–æ—Ç–µ (–ª–æ–∫–∏, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)
- [x] –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

## üñºÔ∏è –°–∫—Ä–∏–Ω—à–æ—Ç—ã / –î–µ–º–æ

–î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ 2‚Äì3 —Å–∫—Ä–∏–Ω–∞ –∏–ª–∏ GIF:

- /tasks —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –∫–Ω–æ–ø–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏–π
- /add ‚Äî —à–∞–≥–∏ —Å–æ–∑–¥–∞–Ω–∏—è
- /tasks_compact ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –±–æ—Ç–∞ —á–µ—Ä–µ–∑ X‚ÄëInternal‚ÄëToken (–±–µ–∑ JWT)
- –í—ã–∑–æ–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî —Å—Ç—Ä–æ–≥–æ –ø–æ JWT Bearer; —Ç–æ–∫–µ–Ω—ã –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±–æ—Ç–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ per‚Äëchat

## üó∫Ô∏è Roadmap

- [ ] –ü–µ—Ä–µ–Ω–æ—Å —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –≤ backend (—Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Å–µ—Å—Å–∏–∏)
- [ ] –†–∞—Å—Å—ã–ª–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –¥–µ–¥–ª–∞–π–Ω–∞—Ö —á–µ—Ä–µ–∑ Celery + –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç –±–æ—Ç–∞
- [ ] –ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ inline‚Äë–ø–æ–∏—Å–∫ –≤ –±–æ—Ç–µ
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è DRF –∏ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –±–æ—Ç–∞

## üß© –°—Ç–µ–∫

- Django 5, DRF, SimpleJWT
- Aiogram 3, FastAPI
- PostgreSQL, Redis, Celery
- Docker, Docker Compose

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ.

## üß™ –¢–µ—Å—Ç—ã (Docker)

–ó–∞–ø—É—Å–∫ —é–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç–æ–≤ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ):

- Backend (Django + DRF):

```bash
docker compose build backend-tests
docker compose run --rm backend-tests
```

- Bot (Aiogram + —É—Ç–∏–ª–∏—Ç—ã):

```bash
docker compose build bot-tests
docker compose run --rm bot-tests
```

- –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–∞ –∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

```bash
docker compose up --build --abort-on-container-exit bot-tests backend-tests
```

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:

- Backend‚Äë—Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–µ—Å—Ç–æ–≤—É—é –ë–î; –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ `manage.py test`.
- –ï—Å–ª–∏ –≤ VS Code –∑–∞–¥–∞—á–∞ "pytest -q" –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –ø–∞–¥–∞–µ—Ç —Å `Exit Code: 127`, —Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω pytest. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker‚Äë–∫–æ–º–∞–Ω–¥—ã –≤—ã—à–µ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pytest –Ω–∞ —Ö–æ—Å—Ç–µ.